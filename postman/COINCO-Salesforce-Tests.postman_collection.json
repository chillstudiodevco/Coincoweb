{
  "info": {
    "name": "COINCO - Salesforce Integration Tests",
    "description": "Colección para probar la conexión con Salesforce antes de integrar en la aplicación",
    "schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
  },
  "item": [
    {
      "name": "1. Obtener Access Token (OAuth Password Flow)",
      "request": {
        "method": "POST",
        "header": [
          {
            "key": "Content-Type",
            "value": "application/x-www-form-urlencoded"
          }
        ],
        "body": {
          "mode": "urlencoded",
          "urlencoded": [
            {
              "key": "grant_type",
              "value": "password",
              "description": "Tipo de flujo OAuth"
            },
            {
              "key": "client_id",
              "value": "{{CONSUMER_KEY}}",
              "description": "Consumer Key de la Connected App"
            },
            {
              "key": "client_secret",
              "value": "{{CONSUMER_SECRET}}",
              "description": "Consumer Secret de la Connected App"
            },
            {
              "key": "username",
              "value": "{{SF_USERNAME}}",
              "description": "Usuario de Salesforce"
            },
            {
              "key": "password",
              "value": "{{SF_PASSWORD}}",
              "description": "Password + Security Token (sin espacios)"
            }
          ]
        },
        "url": {
          "raw": "{{SF_LOGIN_URL}}/services/oauth2/token",
          "host": [
            "{{SF_LOGIN_URL}}"
          ],
          "path": [
            "services",
            "oauth2",
            "token"
          ]
        },
        "description": "Obtiene un token de acceso usando el flujo OAuth Password.\n\n**Variables necesarias:**\n- CONSUMER_KEY: Consumer Key de tu Connected App\n- CONSUMER_SECRET: Consumer Secret de tu Connected App\n- SF_USERNAME: Usuario de Salesforce\n- SF_PASSWORD: Contraseña + Security Token (concatenados)\n- SF_LOGIN_URL: https://login.salesforce.com (o https://test.salesforce.com para sandbox)\n\n**Respuesta exitosa:**\n```json\n{\n  \"access_token\": \"00D...\",\n  \"instance_url\": \"https://coinco.my.salesforce.com\",\n  \"id\": \"https://login.salesforce.com/id/00D.../005...\",\n  \"token_type\": \"Bearer\",\n  \"issued_at\": \"1234567890\",\n  \"signature\": \"abc123...\"\n}\n```\n\n**Guarda el `access_token` para usarlo en las siguientes requests!**"
      },
      "response": []
    },
    {
      "name": "2. Obtener Información del Usuario Actual",
      "request": {
        "method": "GET",
        "header": [
          {
            "key": "Authorization",
            "value": "Bearer {{ACCESS_TOKEN}}",
            "description": "Token obtenido del request anterior"
          }
        ],
        "url": {
          "raw": "{{INSTANCE_URL}}/services/data/v59.0/query?q=SELECT Id, Username, Email, Name, IsActive FROM User WHERE Username = '{{SF_USERNAME}}' LIMIT 1",
          "host": [
            "{{INSTANCE_URL}}"
          ],
          "path": [
            "services",
            "data",
            "v59.0",
            "query"
          ],
          "query": [
            {
              "key": "q",
              "value": "SELECT Id, Username, Email, Name, IsActive FROM User WHERE Username = '{{SF_USERNAME}}' LIMIT 1"
            }
          ]
        },
        "description": "Consulta información del usuario autenticado.\n\n**Requiere:**\n- ACCESS_TOKEN del request anterior\n- INSTANCE_URL de la respuesta del login (ej: https://coinco.my.salesforce.com)"
      },
      "response": []
    },
    {
      "name": "3. Consultar Organización",
      "request": {
        "method": "GET",
        "header": [
          {
            "key": "Authorization",
            "value": "Bearer {{ACCESS_TOKEN}}"
          }
        ],
        "url": {
          "raw": "{{INSTANCE_URL}}/services/data/v59.0/query?q=SELECT Id, Name, OrganizationType, InstanceName, IsSandbox FROM Organization LIMIT 1",
          "host": [
            "{{INSTANCE_URL}}"
          ],
          "path": [
            "services",
            "data",
            "v59.0",
            "query"
          ],
          "query": [
            {
              "key": "q",
              "value": "SELECT Id, Name, OrganizationType, InstanceName, IsSandbox FROM Organization LIMIT 1"
            }
          ]
        },
        "description": "Obtiene información de la organización de Salesforce."
      },
      "response": []
    },
    {
      "name": "4. Listar Objetos Disponibles",
      "request": {
        "method": "GET",
        "header": [
          {
            "key": "Authorization",
            "value": "Bearer {{ACCESS_TOKEN}}"
          }
        ],
        "url": {
          "raw": "{{INSTANCE_URL}}/services/data/v59.0/sobjects",
          "host": [
            "{{INSTANCE_URL}}"
          ],
          "path": [
            "services",
            "data",
            "v59.0",
            "sobjects"
          ]
        },
        "description": "Lista todos los objetos (sObjects) disponibles en tu org."
      },
      "response": []
    },
    {
      "name": "5. Crear ContentVersion (Subir Archivo Test)",
      "request": {
        "method": "POST",
        "header": [
          {
            "key": "Authorization",
            "value": "Bearer {{ACCESS_TOKEN}}"
          },
          {
            "key": "Content-Type",
            "value": "application/json"
          }
        ],
        "body": {
          "mode": "raw",
          "raw": "{\n  \"Title\": \"Test_Document\",\n  \"PathOnClient\": \"test.txt\",\n  \"VersionData\": \"VGVzdCBkb2N1bWVudCBjb250ZW50\",\n  \"Description\": \"Documento de prueba desde Postman\"\n}",
          "options": {
            "raw": {
              "language": "json"
            }
          }
        },
        "url": {
          "raw": "{{INSTANCE_URL}}/services/data/v59.0/sobjects/ContentVersion",
          "host": [
            "{{INSTANCE_URL}}"
          ],
          "path": [
            "services",
            "data",
            "v59.0",
            "sobjects",
            "ContentVersion"
          ]
        },
        "description": "Prueba de subida de archivo a Salesforce.\n\n**Nota:** `VersionData` debe ser el contenido del archivo en Base64.\n\nEl ejemplo usa: \"Test document content\" en Base64."
      },
      "response": []
    }
  ],
  "variable": [
    {
      "key": "SF_LOGIN_URL",
      "value": "https://login.salesforce.com",
      "description": "URL de login (usa https://test.salesforce.com para sandbox)"
    },
    {
      "key": "CONSUMER_KEY",
      "value": "TU_CONSUMER_KEY_AQUI",
      "description": "Consumer Key de tu Connected App"
    },
    {
      "key": "CONSUMER_SECRET",
      "value": "TU_CONSUMER_SECRET_AQUI",
      "description": "Consumer Secret de tu Connected App"
    },
    {
      "key": "SF_USERNAME",
      "value": "tu@email.com",
      "description": "Usuario de Salesforce"
    },
    {
      "key": "SF_PASSWORD",
      "value": "TuPassword123!TokenABC",
      "description": "Password + Security Token (concatenados, SIN ESPACIOS)"
    },
    {
      "key": "ACCESS_TOKEN",
      "value": "",
      "description": "Token obtenido del primer request (se actualiza automáticamente)"
    },
    {
      "key": "INSTANCE_URL",
      "value": "https://coinco.my.salesforce.com",
      "description": "URL de tu instancia (se obtiene del login)"
    }
  ]
}
